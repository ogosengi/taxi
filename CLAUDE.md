# Claude Code 세션 컨텍스트

## 최우선 조건
- **선행 작업**: GitHub과 동기화
- 소스가 변경 되면 CLAUDE.md 파일도 항상 업데이트
- 소스가 변경 되면 자동으로 GitHub에 push

## 프로젝트 개요
- **프로젝트명**: TaxiManager
- **타입**: Windows Forms 애플리케이션
- **언어**: C#
- **GitHub 저장소**: https://github.com/ogosengi/taxi

## 요구사항
- C# Windows Forms 애플리케이션
- 소스 주석은 항상 한글로 작성
- 코드는 최소한의 코드로 작성

### 기능 요구사항
- **택시 운행 관리 프로그램**
- **근무시간 관리**:
  - 근무 시작시간과 끝시간을 자유롭게 설정 가능
  - 다음날까지 이어지는 근무 지원 (예: 10시-다음날 2시)
  - 완전히 유연한 근무시간 패턴 지원
- **매출 관리**:
  - 일별 마감 방식의 매출 입력
  - 마감 후 매출 확인 및 관리 기능
- **운행 현황 및 정보 확인**:
  - 택시 운행 현황 조회 (월별/기간별)
  - 다양한 운행 통계 정보 확인

## 현재 상태 (2025-09-17)
### ✅ 완성된 기능들
- 초기 프로젝트 생성 및 GitHub 연동
- 완전히 유연한 근무시간 설정 기능
- 일별 마감 시스템 및 매출 관리
- 월별/기간별 통계 및 운행 현황 조회
- 일별 마감자료 조회/관리 기능
- 반응형 UI 레이아웃 (자동 크기 조정)
- SQLite 데이터베이스 도입 및 최적화
- 데이터 영속성 문제 해결
- **UI 개선**: 근무시간 입력 방식 최적화
- **UX 개선**: 팝업 제거로 사용자 경험 향상
- **데이터 공유**: GitHub을 통한 taxidata.db 공유
- **정렬 개선**: 일별 마감자료 조회를 마감일 오름차순으로 정렬
- **데이터 구조 개선**: 근무시간 목록에서 매출 컬럼 제거 (UI/DB 모두)

### 📊 품질 지표
- **빌드 상태**: 경고 0개, 오류 0개 ✅
- **코드 품질**: 47개 한글 XML 주석 적용 ✅
- **데이터베이스**: 최적화된 2개 테이블 구조 + 자동 마이그레이션 ✅
- **UI/UX**: 반응형 레이아웃 + 최적화된 입력 방식 ✅
- **안정성**: 데이터 보존 마이그레이션 지원 ✅

## 핵심 아키텍처

### 모델 구조
```csharp
TaxiWorkShift    // 근무시간 정보 (유연한 시간 설정)
DailySettlement  // 일별 마감 정보 (매출 및 통계)
TaxiOperationStats // 운행 현황 통계
```

### 데이터베이스 스키마
```sql
-- 근무시간 테이블 (매출 컬럼 제거됨)
CREATE TABLE WorkShifts (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    Date TEXT NOT NULL,
    StartTime TEXT NOT NULL,
    EndTime TEXT NOT NULL,
    IsNightShift INTEGER NOT NULL,
    Notes TEXT
);

-- 일별마감 테이블 (최적화됨)
CREATE TABLE DailySettlements (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    Date TEXT NOT NULL UNIQUE,
    TotalRevenue REAL NOT NULL,
    TotalWorkingHours REAL NOT NULL,
    Notes TEXT
);
```

## 기술 스택
- **언어**: C#
- **프레임워크**: .NET 8.0, Windows Forms
- **데이터베이스**: SQLite (Microsoft.Data.Sqlite 9.0.9)
- **엑셀 처리**: EPPlus 8.1.1 (비상업적 라이센스)
- **저장소**: GitHub (https://github.com/ogosengi/taxi)

## 주요 특징
1. **완전한 시간 유연성**: 다음날까지 이어지는 근무 지원
2. **일별 마감 시스템**: 체계적인 매출 관리
3. **반응형 UI**: 화면 크기 변경 시 자동 조정
4. **데이터 영속성**: 안정적인 SQLite 저장
5. **통합 관리**: 근무시간부터 매출 분석까지
6. **개선된 입력 방식**: 년도 드롭다운, 월/일 탭 전환, 최적화된 탭 순서
7. **향상된 UX**: 팝업 제거로 깔끔한 사용자 경험
8. **엑셀 통합**: 전문적인 리포트 및 작업용 엑셀 파일 생성

## 개발 명령어
```bash
# 프로젝트 빌드
dotnet build

# 애플리케이션 실행
dotnet run --project TaxiManager

# 데이터베이스 위치
# D:\DEV\vibe\taxi\TaxiManager\bin\Debug\net8.0-windows\taxidata.db
```

## 작업 환경
- **작업 디렉토리**: D:\DEV\taxi
- **Git 브랜치**: master (origin 연결)
- **사용자**: ogosengi

## 최신 업데이트 (2025-09-17)
### 🎯 주요 개선사항
- **근무시간 입력 최적화**:
  - 년도: 드롭다운 선택 (현재년도 ±7년)
  - 월/일: NumericUpDown 컨트롤로 탭 전환 지원
  - 탭 순서: 월 → 일 → 시작시간 → 종료시간 → 야간근무 → 메모 → 추가
  - 매출조회 탭순서: 마감일 → 매출 → 일별마감
- **UX 향상**:
  - 팝업 제거: 근무시간 추가, 일별마감, 마감자료 조회 시 알림 팝업 제거
  - 레이아웃 개선: 메모 입력란 옆으로 추가 버튼 이동
  - 그리드 스크롤: 추가한 데이터가 정확히 보이도록 자동 스크롤
- **데이터 관리 개선**:
  - 그리드 정렬: 날짜 오름차순 정렬
  - 시간당 평균: 소수점 1자리 표시
  - 마감처리 일시 필드 제거 (DB/UI 모두)
  - 근무시간 입력 시 마감일 자동 대입
- **통계 정보 개선**:
  - 총 근무 횟수 → 총 근무 일수로 변경
  - 완료된 근무 관련 항목 제거
  - 더 직관적이고 간결한 통계 정보
- **데이터베이스 마이그레이션**:
  - 기존 데이터 보존하면서 스키마 변경
  - 자동 마이그레이션 로직 구현
- **데이터 공유**: taxidata.db 파일을 GitHub에 업로드하여 온라인 공유 가능

## 최신 업데이트 (2025-09-17 오후)
### 🔧 데이터 구조 개선
- **근무시간 테이블 최적화**:
  - WorkShifts 테이블에서 Revenue 컬럼 완전 제거
  - 자동 마이그레이션으로 기존 데이터 보존
  - 근무시간과 매출을 분리하여 더 명확한 데이터 구조
- **UI 정리**:
  - 근무시간 목록에서 매출 컬럼 제거
  - 매출은 일별 마감 시에만 입력하는 구조로 단순화
- **정렬 개선**:
  - 일별 마감자료 조회를 마감일 오름차순으로 변경
- **사용성 개선**:
  - 근무시간 입력 후 입력값 유지 (현재 날짜로 되돌아가지 않음)
  - 탭 이동 시 텍스트 자동 선택으로 빠른 수정 가능
- **효율성 분석 기능 추가**:
  - 시간대별 효율성 통계 계산 및 표시
  - 가장 효율적인 근무 시간대 자동 분석
  - 기간별 운행 현황에 효율성 정보 포함
- **근무시간 계산 개선**:
  - 종료시간 00:00 입력 시 다음날 자정으로 정확히 처리
  - 야간근무 자동 체크 기능 (종료시간이 00:00이거나 시작시간보다 작을 때)
- **엑셀 내보내기 기능 추가**:
  - 택시 운행 데이터를 엑셀 파일로 내보내기
  - 요약통계, 근무시간, 일별마감, 시간대별효율성 시트 생성
  - 전문적인 리포트 형태로 데이터 관리 가능
- **엑셀 작업용 파일 생성**:
  - 각 테이블을 별도 시트로 구성 (근무시간데이터, 일별마감데이터, 시간대별효율성)
  - 통계대시보드 시트에 수식 기반 자동 계산 추가
  - 차트분석 시트와 월별요약 시트 포함
  - 엑셀에서 직접 편집 및 작업 가능한 구조

### 🔬 효율성 분석 계산식
시간대별 효율성은 다음과 같이 계산됩니다:

1. **매출 비례 배분**:
   - 각 근무시간의 매출 비율 = (해당 근무시간) / (그 날 총 근무시간)
   - 배분된 매출 = 일별 총 매출 × 매출 비율

2. **시간대별 집계**:
   - 시작 시간대별로 매출과 근무시간을 합산
   - 예: 10시 시작 근무들의 총 매출 / 총 근무시간

3. **효율성 계산**:
   - 시간당 평균 매출 = 시간대별 총 매출 / 시간대별 총 근무시간
   - 가장 높은 시간당 매출을 가진 시간대가 최고 효율성

### 🛠️ 기술적 개선
- **안정성**: 데이터베이스 스키마 변경 시 자동 마이그레이션
- **사용성**: 직관적인 입력 방식과 자동화된 워크플로우
- **성능**: 최적화된 데이터 구조와 효율적인 쿼리
- **분석력**: 시간대별 효율성 분석으로 운행 최적화 지원

---
*TaxiManager - 완전한 택시 운행 관리 솔루션*